{% extends "base.html" %}

{% block content %}
    <h1>Properties Data</h1>

    <div class="card mb-4">
        <div class="card-header">
            <h5>Filter Properties</h5>
        </div>
        <div class="card-body">
            <form method="post">
                <div class="form-row">
                    <div class="form-group col-md-3">
                        <label for="min_size">Min Size (sq ft)</label>
                        <input type="number" class="form-control" id="min_size" name="min_size">
                    </div>
                    <div class="form-group col-md-3">
                        <label for="max_size">Max Size (sq ft)</label>
                        <input type="number" class="form-control" id="max_size" name="max_size">
                    </div>
                    <div class="form-group col-md-3">
                        <label for="min_price">Min Price</label>
                        <input type="number" class="form-control" id="min_price" name="min_price">
                    </div>
                    <div class="form-group col-md-3">
                        <label for="max_price">Max Price</label>
                        <input type="number" class="form-control" id="max_price" name="max_price">
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group col-md-4">
                        <label for="filter-client-id">Client ID</label>
                        <select class="form-control" id="filter-client-id" name="client_id">
                            <option value="">Select a client ID</option>
                            {% for client_id in client_ids %}
                            <option value="{{ client_id }}">{{ client_id }}</option>
                            {% endfor %}
                        </select>
                    </div>
                    <div class="form-group col-md-4">
                        <label for="filter-city">City</label>
                        <select class="form-control" id="filter-city" name="city">
                            <option value="">Select a city</option>
                            {% for city in cities %}
                            <option value="{{ city }}">{{ city }}</option>
                            {% endfor %}
                        </select>
                    </div>
                    <div class="form-group col-md-4">
                        <label for="filter-state">State</label>
                        <select class="form-control" id="filter-state" name="state">
                            <option value="">Select a state</option>
                            {% for state in states %}
                            <option value="{{ state }}">{{ state }}</option>
                            {% endfor %}
                        </select>
                    </div>
                </div>
                <button type="submit" class="btn btn-primary">Filter</button>
            </form>
        </div>
    </div>

    <div class="container mt-4">
        <button type="button" class="btn btn-primary mb-3" data-toggle="modal" data-target="#addPropertyModal">
            Add New Property
        </button>
        <table id="data-table" class="display table table-striped table-bordered" width="100%">
            <thead>
                <tr>
                    <th>Property ID</th>
                    <th>Client ID</th>
                    <th>Address</th>
                    <th>City</th>
                    <th>State</th>
                    <th>Zip Code</th>
                    <th>Property Type</th>
                    <th>House Size (sq ft)</th>
                    <th>Price</th>
                    <th>Shown Date</th>
                    <th>Client Name</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody>
                 {{ table | safe }}
            </tbody>
        </table>
    </div>

<!-- Add New Property Modal -->
<div class="modal fade" id="addPropertyModal" tabindex="-1" role="dialog" aria-labelledby="addPropertyModalLabel" aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="addPropertyModalLabel">Add New Property</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <form method="POST" action="{{ url_for('properties.add_property_data') }}">
                <div class="modal-body">
                    <div class="form-group">
                        <label for="client_id">Client ID and Name</label>
                        <select class="form-control" id="client_id" name="client_id" required>
                            <option value="">Select a client ID and Name</option>
                            {% for client in clients %}
                            <option value="{{ client.client_id }}">{{ client.client_id }} - {{ client.name }}</option>
                            {% endfor %}
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="address">Address</label>
                        <input type="text" class="form-control" id="address" name="address" required>
                    </div>
                    <div class="form-group">
                        <label for="city">City</label>
                        <input type="text" class="form-control" id="city" name="city" required>
                    </div>
                    <div class="form-group">
                        <label for="state">State</label>
                        <input type="text" class="form-control" id="state" name="state" required>
                    </div>
                    <div class="form-group">
                        <label for="zip_code">Zip Code</label>
                        <input type="text" class="form-control" id="zip_code" name="zip_code" required>
                    </div>
                    <div class="form-group">
                        <label for="property_type">Property Type</label>
                        <select class="form-control" id="property_type" name="property_type" required>
                            <option value="House">House</option>
                            <option value="Apartment">Apartment</option>
                            <option value="Commercial">Commercial</option>
                            <option value="Land">Land</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="house_size">House Size (sq ft)</label>
                        <input type="number" class="form-control" id="house_size" name="house_size" required>
                    </div>
                    <div class="form-group">
                        <label for="price">Price</label>
                        <input type="number" step="0.01" class="form-control" id="price" name="price" required>
                    </div>
                    <div class="form-group">
                        <label for="shown_date">Shown Date</label>
                        <input type="date" class="form-control" id="shown_date" name="shown_date" required>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                    <button type="submit" class="btn btn-primary">Add Property</button>
                </div>
            </form>
        </div>
    </div>
</div>


<!-- Edit Property Modal -->
<div class="modal fade" id="editPropertyModal" tabindex="-1" role="dialog" aria-labelledby="editPropertyModalLabel" aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="editPropertyModalLabel">Edit Property</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <form id="edit-property-form" method="POST" action="">
                    <input type="hidden" id="edit-property-id" name="property_id">
                    <div class="form-group">
                        <label for="edit-client-id">Client</label>
                        <select class="form-control" id="edit-client-id" name="client_id" required>
                            {% for client in client_ids %}
                            <option value="{{ client }}">{{ client }} - {{ client_names[client] }}</option>
                            {% endfor %}
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="edit-client-name">Client Name</label>
                        <input type="text" class="form-control" id="edit-client-name" name="client_name" readonly>
                    </div>
                    <div class="form-group">
                        <label for="edit-address">Address</label>
                        <input type="text" class="form-control" id="edit-address" name="address" required>
                    </div>
                    <div class="form-group">
                        <label for="edit-city">City</label>
                        <input type="text" class="form-control" id="edit-city" name="city">
                    </div>
                    <div class="form-group">
                        <label for="edit-state">State</label>
                        <input type="text" class="form-control" id="edit-state" name="state">
                    </div>
                    <div class="form-group">
                        <label for="edit-zip-code">Zip Code</label>
                        <input type="text" class="form-control" id="edit-zip-code" name="zip_code">
                    </div>
                    <div class="form-group">
                        <label for="edit-property-type">Property Type</label>
                        <select class="form-control" id="edit-property-type" name="property_type" required>
                            <option value="House">House</option>
                            <option value="Apartment">Apartment</option>
                            <option value="Commercial">Commercial</option>
                            <option value="Land">Land</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="edit-house-size">House Size (sq ft)</label>
                        <input type="number" class="form-control" id="edit-house-size" name="house_size">
                    </div>
                    <div class="form-group">
                        <label for="edit-price">Price</label>
                        <input type="number" step="0.01" class="form-control" id="edit-price" name="price">
                    </div>
                    <div class="form-group">
                        <label for="edit-shown-date">Shown Date</label>
                        <input type="date" class="form-control" id="edit-shown-date" name="shown_date">
                    </div>
                    <button type="submit" class="btn btn-primary">Submit</button>
                </form>
            </div>
        </div>
    </div>
</div>



<!-- Delete Property Modal -->
<div class="modal fade" id="deletePropertyModal" tabindex="-1" role="dialog" aria-labelledby="deletePropertyModalLabel" aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="deletePropertyModalLabel">Delete Property</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                Are you sure you want to delete this property?
            </div>
            <div class="modal-footer">
                <form id="delete-property-form" method="post" action="">
                    <input type="hidden" id="delete-property-id" name="property_id">
                    <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancel</button>
                    <button type="submit" class="btn btn-danger">Delete</button>
                </form>
            </div>
        </div>
    </div>
</div>


    <link rel="stylesheet" href="https://cdn.datatables.net/1.11.5/css/jquery.dataTables.min.css">
{% endblock %}

{% block scripts %}
    <script>
        $(document).ready(function() {
            $('#editPropertyModal').on('show.bs.modal', function (event) {
                var button = $(event.relatedTarget);
                var propertyId = button.data('property-id');
                var clientId = button.data('client-id');
                var address = button.data('address');
                var city = button.data('city');
                var state = button.data('state');
                var zipCode = button.data('zip-code');
                var propertyType = button.data('property-type');
                var houseSize = button.data('house-size');
                var price = button.data('price');
                var shownDate = button.data('shown-date');

                var modal = $(this);
                modal.find('#edit-property-id').val(propertyId);
                modal.find('#edit-client-id').val(clientId);
                modal.find('#edit-address').val(address);
                modal.find('#edit-city').val(city);
                modal.find('#edit-state').val(state);
                modal.find('#edit-zip-code').val(zipCode);
                modal.find('#edit-property-type').val(propertyType);
                modal.find('#edit-house-size').val(houseSize);
                modal.find('#edit-price').val(price);
                modal.find('#edit-shown-date').val(shownDate);
            });


            $('#editPropertyModal').on('show.bs.modal', function (event) {
                var button = $(event.relatedTarget);
                var propertyId = button.data('property-id');
                var clientId = button.data('client-id');
                var clientName = button.data('client-name');
                // Other data attributes

                var modal = $(this);
                modal.find('#edit-property-id').val(propertyId);
                modal.find('#edit-client-id').val(clientId);
                modal.find('#edit-client-name').val(clientName);
                // Populate other fields
            });

            $('#edit-property-form').on('submit', function(event) {
                event.preventDefault();
                // Add your form submission logic here
                $('#editPropertyModal').modal('hide');
            });

            $('#deletePropertyModal').on('show.bs.modal', function (event) {
                var button = $(event.relatedTarget);
                var propertyId = button.data('property-id');
                var form = $('#delete-property-form');
                form.attr('action', '/delete_property_data/' + propertyId);
                form.find('#delete-property-id').val(propertyId);
            });

            $('#delete-property-form').on('submit', function(event) {
                event.preventDefault();
                var form = $(this);
                $.ajax({
                    type: form.attr('method'),
                    url: form.attr('action'),
                    data: form.serialize(),
                    success: function(response) {
                        location.reload();
                    }
                });
            });
        });
    </script>


{% endblock %}